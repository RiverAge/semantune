新Prompt测试结果对比分析
================================================================================

基本统计
--------
- 总歌曲数: 40首
- 无效标签数: 3个
- 白名单合规率: 99.4%

前后对比
--------
旧Prompt: 4条规则 → 5个无效标签 → 98.4%合规率
新Prompt: 9条规则 → 3个无效标签 → 99.4%合规率

改进: 无效标签减少40%, 合规率提升1.0%

详细改进分析
================================================================================

【解决的5个问题】

1. ✅ 已解决: Believer - 合并标签问题
   旧: mood = ["Hopeful", "Dark Melancholic", "Mysterious"]
   新: mood = ["Hopeful", "Dark"]
   原因: 规则2明确禁止组合词如"Dark Melancholic"

2. ✅ 已解决: Svefn-g-englar - Post-rock维度混淆
   旧: genre = ["Ambient", "Post-rock"] (错误，Post-rock应在style)
   新: genre = ["Indie", "Ambient"], style = ["Post-rock", "Cinematic"]
   原因: 规则7明确genre是一级流派，style是子风格

3. ✅ 已解决: First Love - J-Pop移到style
   旧: genre = ["Pop", "J-Pop"]
   新: genre = ["Pop"], style = ["Ballad", "City Pop"]
   原因: J-Pop映射到City Pop(在style白名单中)

4. ❌ 未解决: Dragonborn - Epic仍在mood
   旧: mood = ["Epic", "Mysterious", "Hopeful"]
   新: mood = ["Epic", "Mysterious", "Hopeful"]
   问题: Epic在风格化音乐(游戏)中很常见，LLM习惯性输出
   建议: 需要在Prompt中明确列出禁止的标签

5. ⚠️ 部分解决: アイドル - J-Pop问题
   新: genre = ["Pop", "J-Pop"], style = ["Ballad", "City Pop"]
   问题: genre中仍有"J-Pop"
   原因: J-Pop作为日本流行音乐的核心标签，倾向性太强

【新出现问题】
夜に駆ける - 出现J-Pop
  genre = ["Pop", "J-Pop"]
  style = ["Ballad", "Acoustic"]

================================================================================

剩余3个无效标签详情
--------------------
1. Dragonborn: mood = ["Epic", "Mysterious", "Hopeful"]
   问题: Epic不在mood白名单

2. アイドル: genre = ["Pop", "J-Pop"]
   问题: J-Pop不在genre白名单

3. 夜に駆ける: genre = ["Pop", "J-Pop"]
   问题: J-Pop不在genre白名单

================================================================================

规则有效性评估
--------------
规则2 (禁止组合词): ✅ 有效 - 解决了"Dark Melancholic"
规则4 (替换非法标签): ⚠️ 部分有效 - First Love成功，但J-Pop映射不彻底
规则7 (genre/style区分): ✅ 有效 - 解决了Post-rock维度混淆
规则8 (输出前检查): ✅ 有效 - 减少了错误率，但Epic和J-Pop仍顽固

================================================================================

问题根因
--------
1. Epic: 游戏音乐的高频标签，LLM在训练数据中见得太多，习惯性输出
2. J-Pop: 日本流行音乐的核心标签，对YOASOBI、宇多田光等歌手尤其强烈

================================================================================

建议优化方向
------------
方案A: 明确禁止列表
  在Prompt中增加:
  【明确禁止的标签】
  - Epic, Energetic, Upbeat, Groovy, Chill (mood维度)
  - J-Pop, K-Pop, C-Pop (genre维度，应映射到Pop+style)
  任何情况下都不得使用这些标签

方案B: 映射规则
  增加标签映射表:
  - Epic → Hopeful + Dark (mood)
  - J-Pop → Pop + City Pop + Japanese (genre + style + region)

方案C: 加入白名单
  讨论是否应该在适当位置加入这些标签

================================================================================
