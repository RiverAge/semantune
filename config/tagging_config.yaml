# 标签配置文件
# Semantune 标签生成系统配置

# 标签白名单
allowed_labels:
  mood:
    - Happy
    - Sad
    - Romantic
    - Peaceful
    - Dreamy
    - Dark
    - Melancholic
    - Hopeful
    - Nostalgic
    - Mysterious
    - Playful
    - Warm
  energy:
    - Low
    - Medium
    - High
  genre:
    - Pop
    - Rock
    - Hip-Hop
    - R&B
    - Electronic
    - Folk
    - Jazz
    - Classical
    - Metal
    - Indie
    - Soundtrack
    - Ambient
    - World
    - None
  style:
    - Ballad
    - Acoustic
    - Orchestral
    - Cinematic
    - Lo-fi
    - Synthwave
    - Trap
    - House
    - Techno
    - EDM
    - Alternative
    - Post-rock
    - Hard Rock
    - Soft Rock
    - Dream Pop
    - Minimalist
    - Retro
    - Modern
    - Punk
    - City Pop
  scene:
    - Sleep
    - Study
    - Relax
    - Focus
    - Driving
    - Workout
    - Running
    - Party
    - Background
    - Travel
    - Morning
    - Night
    - Meditation
    - Gaming
  region:
    - Chinese
    - Taiwanese
    - Hong Kong
    - Japanese
    - Korean
    - Western
    - Other
  culture:
    - Anime
    - Game
    - Film
    - TV
    - Idol
    - Vocaloid
    - None
  language:
    - Chinese
    - Japanese
    - Korean
    - English
    - Instrumental
    - Other

# 自定义提示词模板（支持歌词）
prompt_template: |
  你是专业音乐标签系统。请根据歌曲信息输出严格符合规则的JSON标签。

  【强制执行规则】
  1. 只能使用白名单中的标签，不得创造新标签。
  2. 每个标签必须是白名单中的单个完整词条，不允许组合词或拼接词（例如禁止 "Dark Melancholic"）。
  3. 严格遵守每个字段的数量限制。
  4. **如果最合适的语义标签不在白名单中，必须严格遵循【禁止标签及fallback映射】规则转换为合法标签，绝对不能输出禁止标签。**
  5. 如果不确定，请选择更少标签而不是猜测。
  6. language 判断原则：除非 100% 确定是纯音乐（仅乐器演奏、无人声、无唱词），否则不得标记为 "Instrumental"。
  7. genre 表示一级商业流派；style 表示子风格、质感或制作风格。若有冲突，请保持 genre 更宽泛。
  8. 在输出前，请逐字段检查是否违反以上规则，并在发现问题时自动修正。
  9. **只输出标准JSON格式，绝对不能包含任何注释、箭头符号("->")或解释文字。JSON中的每个值必须是直接的标签，不能是转换表达式。**

  【完全禁止的标签（绝对不得在任何字段输出）】
  Vocal  # 有人声概念由language维度表达，style中禁止使用

  【禁止标签及 fallback 映射（必须严格遵循）】

  Mood 禁止 → fallback（绝对禁止输出任何禁止标签，必须严格转换为以下合法标签）：
  - Epic → **绝对禁止（任何情况下都不能在mood字段输出，即使是非常宏大的音乐也不行），改为 energy=High + style=Cinematic，从mood字段只选择Hopeful/Dark/Mysterious/Peaceful之一，绝对不能包含Epic
  - Energetic → **绝对禁止（任何情况下都不能在mood字段输出），改为 energy=High，mood从[Happy, Hopeful, Playful, Warm]中选择1-2个
  - Upbeat → 改为 mood=Happy + energy=High
  - Groovy → 改为 mood=Playful，优先选择 style=House 或 style=Retro（二选一）
  - Chill → 改为 mood=Peaceful + energy=Low 或 mood=Dreamy + energy=Low（二选一）
  - Emotional → 改为 mood=Melancholic 或 mood=Sad（二选一）

  Genre 禁止 → fallback：
  - J-Pop → genre=Pop + region=Japanese（同时输出）
  - K-Pop → genre=Pop + region=Korean（同时输出）
  - C-Pop → genre=Pop + region=Chinese（同时输出）
  - J-Rock → genre=Rock + region=Japanese（同时输出）
  - K-Rock → genre=Rock + region=Korean（同时输出）
  - Indie Rock → genre=Rock + style=Alternative（同时输出）
  - Synth Pop → genre=Pop + style=Synthwave（同时输出）

  Style 禁止 → fallback（按优先级选择）：
  - Grunge → 首选 style=[Alternative, Hard Rock]（同时输出2个），备选 style=[Alternative]（输出1个）
  - Piano → 首选 style=[Minimalist, Acoustic]（同时输出2个），备选 style=[Minimalist]（输出1个）
  - Funk → 改为 style=Retro 或 style=City Pop（二选一），风格类似请使用白名单中已有的标签
  - Guitar → 改为 style=Acoustic（输出1个）
  - Violin → 改为 style=Orchestral（输出1个）
  - Instrumental → **绝对禁止在style中使用**，只在language维度使用。如果音乐纯器乐，选择style=Minimalist、style=Ambient或style=Cinematic之一（输出1个）
  - **任何其他不在白名单中的style标签 → 必须用白名单中最接近的合法标签替换，绝对不能输出**

  Language 纠错规则：
  - 如果误标为 Instrumental 但有人声 → 改为实际语言（Chinese/Japanese/Korean/English/Other）
  - 如果语言无法判断 → language=Other

  【高优先级纠错规则】

  1. 判断 language 是否为 Instrumental 时，严格遵循以下标准：
     - 仅有纯音乐（无任何人声、哼唱、Vocaloid）才能标记为 Instrumental
     - 包含歌词或人声的歌曲，language 绝对不得为 Instrumental
     - 如果无法确定是否有人声，默认假设有人声（特别是流行/动漫/游戏音乐）

  2. 特殊类型歌曲的 language 判断规则：
     - Vocaloid 作品（初音ミク、巡音ルカ、GUMI 等）→ language 必须为实际语言，绝不能是 Instrumental
     - 所有 OST（动漫/游戏/电影/电视剧）→ 默认为实际语言，除非明确标注为背景音乐(BGM)/纯音乐
     - 日本/韩国的流行/动漫/游戏音乐 → 强烈偏向有人声，language 应为 Japanese/Korean
     - 包含人声的电子音乐（如 Daft Punk）→ language 为实际语言，不是 Instrumental
     - 任何包含演唱、说唱、合声的歌曲 → language 不能是 Instrumental

  3. OST / Anime / Game 类型的 genre/classification 与 language 是独立维度：
     - culture=Anime/Game/Film/TV 不能推导出 language=Instrumental
     - 是否标记为 Instrumental 仅取决于：是否包含任何形式的人声
     - 大多数动漫/游戏 OP/ED/插入歌都有歌词，language 必须标注实际语言
     - 只有明确标注为 BGM/Soundtrack/Background Music 的纯音乐才能标记为 Instrumental

  4. 出现冲突时的优先级（从高到低）：
     - 第一优先级：language 正确性（有人声绝不能标 Instrumental）
     - 第二优先级：genre/style 合理性
     - 第三优先级：mood 精细度

  5. 关键判断原则：
     - 如果歌曲标题包含以下词汇，倾向于有人声：歌、曲、主题歌、主题曲、OP、ED、插入歌、FLAGS
     - 如果是艺术家的知名歌曲（如 Daft Punk 的 Get Lucky），假设有人声
     - 只有明确知道是纯音乐的情况下才标记为 Instrumental
     - culture 为 Game/Anime/Film/TV 的歌曲，除非标题明确写 BGM/Background/Piano Version，否则假设有人声

  【歌曲信息】
  标题: {title}
  艺术家: {artist}
  专辑: {album}
  歌词: {lyrics}

  【标签白名单】

  mood (选择 1–3 个，按重要性排序):
  Happy, Sad, Romantic, Peaceful, Dreamy, Dark,
  Melancholic, Hopeful, Nostalgic, Mysterious, Playful, Warm

  energy (选择 1 个):
  Low, Medium, High

  genre (选择 1–2 个):
  Pop, Rock, Hip-Hop, R&B, Electronic, Folk,
  Jazz, Classical, Metal, Indie, Soundtrack, Ambient, World, None

  style (选择 0–3 个):
  Ballad, Acoustic, Orchestral, Cinematic, Lo-fi,
  Synthwave, Trap, House, Techno, EDM,
  Alternative, Post-rock, Hard Rock, Soft Rock,
  Dream Pop, Minimalist, Retro, Modern, Punk, City Pop

  scene (选择 0–2 个):
  Sleep, Study, Relax, Focus, Driving, Workout,
  Running, Party, Background, Travel,
  Morning, Night, Meditation, Gaming

  region (选择 1 个):
  Chinese, Taiwanese, Hong Kong, Japanese, Korean, Western, Other

  culture (选择 1 个):
  Anime, Film, TV, Game, Idol, Vocaloid, None

  language (选择 1 个):
  Chinese, Japanese, Korean, English, Instrumental, Other

  【输出格式】
  ```json
  {{
    "mood": ["Hopeful", "Dark"],
    "energy": "High",
    "genre": ["Soundtrack"],
    "style": ["Cinematic", "Orchestral"],
    "scene": ["Gaming"],
    "region": "Western",
    "culture": "Game",
    "language": "Instrumental",
    "confidence": 0.95
  }}
  ```
  
  **重要：上面的JSON只是示例格式。实际输出中每个字段只能是白名单中的合法标签，绝对不能输出禁止标签或显示转换过程。**

# API 调用配置
api:
  timeout: 60
  max_tokens: 1024
  temperature: 0.2
  top_p: 0.9
  retry_delay: 1
  max_retries: 3
  retry_backoff: 2
  max_concurrent: 5
